# –û –ø—Ä–æ–µ–∫—Ç–µ

CRM ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—ã–π backend + frontend, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

Backend: Node.js (@crm/core)
Frontend: React
–ë–î: PostgreSQL
–ú–∏–≥—Ä–∞—Ü–∏–∏: SQL-first (dbmate)

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
core/          # backend API (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
db/
  migrations/  # –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã
  schema.sql   # –ø–æ–ª–Ω—ã–π —Å–ª–µ–ø–æ–∫ —Å—Ö–µ–º—ã –ë–î (read-only)
```

## –ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å backend –ª–æ–∫–∞–ª—å–Ω–æ

```
cd core
pnpm install
pnpm run start
```

Backend –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞:

```
http://127.0.0.1:3000
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```
DATABASE_URL=postgres://crm_app:***@localhost:5432/crm
PORT=3000
NODE_ENV=development
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

–ú–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é:

```
dbmate up
```

Backend –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –º–∏–≥—Ä–∞—Ü–∏—è–º

- –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ—Ñ–æ—Ä–º–ª—è—é—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –Ω–æ–≤—ã–º–∏ SQL-first –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ (dbmate).
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ `db/schema.sql` –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç—Å—è.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ON CONFLICT DO NOTHING/UPDATE` –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).
- `schema_migrations` —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ dbmate.

## üîê –†–æ–ª—å –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ì–ª–∞–≤–Ω–æ–º—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω—ã:

- —Ä–æ–ª—å **admin**;
- –≤—Å–µ permissions;
- –¥–æ—Å—Ç—É–ø –∫:
  - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —Å–∏—Å—Ç–µ–º—ã,
  - —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —è–∑—ã–∫–∞–º–∏,
  - —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏,
  - —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏.

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–µ–ª–∞–µ—Ç—Å—è **–≤—Ä—É—á–Ω—É—é** (–Ω–µ —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏).

–ü—Ä–∏–º–µ—Ä SQL (—Ä—É—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ù–ï –º–∏–≥—Ä–∞—Ü–∏—è):

```sql
-- 1) –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT id, email FROM core.users WHERE email = 'admin@example.com';

-- 2) –ù–∞–π—Ç–∏ —Ä–æ–ª—å admin
SELECT id, code FROM core.roles WHERE code = 'admin';

-- 3) –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
INSERT INTO core.user_roles (user_id, role_id)
VALUES ('<user_id>', '<role_id>')
ON CONFLICT DO NOTHING;
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

- –û–¥–∏–Ω backend ‚Äî –æ–¥–∏–Ω API
- –î–æ–º–µ–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è —è–≤–Ω–æ
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
- –ú–∏–Ω–∏–º—É–º –º–∞–≥–∏–∏, –º–∞–∫—Å–∏–º—É–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏

## –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π API

–ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∏–π API –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –±–∞–∑–æ–≤–æ–º—É –ø—É—Ç–∏:

```
/api/partners/v1
```

–û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–æ–º –∂–µ backend, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–∏—Å—ã.
